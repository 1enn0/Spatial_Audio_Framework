# Spatial_Audio_Framework

#TODO: User definable INTELMKL, SAF_ENABLE_SOFA reader
#AND INSTALL PATH for the dylib; make new test program that only uses cmake generated library, which is also generated by CMAKE
#Move the target_sources(${PROJECT_NAME} PRIVATE 
   # ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_cdf4sap/saf_cdf4sap.h
   # etc. to a seperate CMAKlists inside the framework folder. 


cmake_minimum_required(VERSION 3.15)

# Configure project
project(saf VERSION 1.0.0 LANGUAGES C)
add_library(${PROJECT_NAME} SHARED)
set_target_properties(${PROJECT_NAME}
PROPERTIES
    VERSION ${PROJECT_VERSION}
    SOVERSION ${PROJECT_VERSION}
)
 
# Source
target_sources(${PROJECT_NAME} PRIVATE 
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_cdf4sap/saf_cdf4sap.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_hoa/saf_hoa_internal.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_hoa/saf_hoa_internal.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_hoa/saf_hoa.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_hrir/saf_default_hrirs.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_hrir/saf_hrir_internal.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_hrir/saf_hrir_internal.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_hrir/saf_hrir.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_reverb/saf_reverb_internal.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_reverb/saf_reverb_internal.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_reverb/saf_reverb.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_sh/saf_sh_internal.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_sh/saf_sh_internal.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_sh/saf_sh.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_sofa_reader/saf_sofa_reader.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_bessel.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_complex.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_decor.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_erb.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_error.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_fft.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_filters.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_loudspeaker_presets.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_matrixConv.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_misc.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_pitch.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_sensorarray_presets.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_sort.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_veclib.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_vbap/saf_vbap_internal.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_vbap/saf_vbap_internal.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_vbap/saf_vbap.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/resources/afSTFT/afSTFT_protoFilter.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/resources/afSTFT/afSTFTlib.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/resources/convhull_3d/convhull_3d.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/resources/convhull_3d/convhull_3d.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/resources/kissFFT/_kiss_fft_guts.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/resources/kissFFT/kiss_fft.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/resources/kissFFT/kiss_fftr.c
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/resources/md_malloc/md_malloc.c
)

include(GNUInstallDirs)

add_compile_definitions(SAF_USE_INTEL_MKL)
set(INTEL_MKL_HEADER_PATH "/opt/intel/compilers_and_libraries/mac/mkl/include")
set(INTEL_MKL_LIB "/usr/local/lib/libsaf_mkl_custom.dylib")

target_include_directories(${PROJECT_NAME} PRIVATE ${INTEL_MKL_HEADER_PATH})
target_link_libraries(${PROJECT_NAME} PRIVATE ${INTEL_MKL_LIB})

target_include_directories(
    ${PROJECT_NAME} PUBLIC
    $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/framework/include/>  
    $<INSTALL_INTERFACE:${CMAKE_INSTALL_INCLUDEDIR}>)

# sets the _EXPORT #define for the target (library)
# to ensure the functions are exported (visible)
target_compile_definitions(
    ${PROJECT_NAME} PRIVATE -D_EXPORT)

# specify the target to install (calculator library defined above)
# set the export name <name>-config (does not need to match target name)
# also specify where the .dylib/.so/.dll+.lib file should be installed
install(
    TARGETS ${PROJECT_NAME}
    EXPORT ${PROJECT_NAME}-config
    RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
    LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
    ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR})

install(
    EXPORT ${PROJECT_NAME}-config
    NAMESPACE ${PROJECT_NAME}::
    DESTINATION ${CMAKE_INSTALL_LIBDIR}/cmake/${PROJECT_NAME})

install(
FILES 
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_cdf4sap/saf_cdf4sap.h 
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_hoa/saf_hoa.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_hrir/saf_hrir.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_reverb/saf_reverb.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_sh/saf_sh.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_sofa_reader/saf_sofa_reader.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_bessel.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_complex.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_decor.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_erb.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_error.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_fft.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_filters.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_sensorarray_presets.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_sort.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_matrixConv.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_loudspeaker_presets.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_misc.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_pitch.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_utilities.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_utilities/saf_veclib.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/modules/saf_vbap/saf_vbap.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/resources/afSTFT/afSTFTlib.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/resources/kissFFT/kiss_fft.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/resources/kissFFT/kiss_fftr.h
    ${CMAKE_CURRENT_SOURCE_DIR}/framework/resources/md_malloc/md_malloc.h 
DESTINATION 
    ${CMAKE_INSTALL_INCLUDEDIR}/${PROJECT_NAME})

install(
    DIRECTORY ${CMAKE_CURRENT_LIST_DIR}/framework/include/ 
    DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}/${PROJECT_NAME})


 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Spatial_Audio_Framework: Acquiring and linking a custom &lt;a href=&quot;https://software.intel.com/en-us/articles/free-ipsxe-tools-and-libraries&quot;&gt;Intel MKL&lt;/a&gt; library tailored for SAF</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Spatial_Audio_Framework
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md___users_mccorml1__documents__source_tree__s_p_a_r_t_a__v_s_ts_public__s_d_ks__spatial__audio_62d8dbec06e63dbce9c30763e4296ca7.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Acquiring and linking a custom <a href="https://software.intel.com/en-us/articles/free-ipsxe-tools-and-libraries">Intel MKL</a> library tailored for SAF </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Spatial_Audio_Framework (SAF) requires any library (or combination of libraries) which supports the CBLAS and LAPACK standards. Personally, we like Intel MKL for this task, as it works well and also has an optimised FFT implementation which SAF can use too.</p>
<p>Note that you may link directly to the Intel MKL static or dynamic libraries, but these are stupidly huge. This is why we like to use the MKL builder to build a custom MKL library, and below are instructions for Windows/MacOSX/Linux users rocking x86_64/amd64 CPUs.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Windows (64-bit) users</h1>
<p>Note: use the "x64 Developer Command Prompt for VS.exe" (open as administrator) to run the following commands.</p>
<ol type="1">
<li>Install <a href="https://software.intel.com/en-us/articles/free-ipsxe-tools-and-libraries">Intel MKL</a>.</li>
<li>The required custom library may be obtained by first copying the included "**dependencies/saf_mkl_list**" file into the MKL "builder" folder:</li>
</ol>
<div class="fragment"><div class="line">xcopy saf_mkl_list C:\Program Files (x86)\IntelSWTools\compilers_and_libraries\windows\mkl\tools\builder /R</div>
</div><!-- fragment --><ol type="1">
<li>EITHER (The blue pill): to generate and copy the "**saf_mkl_custom.dll**" library to a system path folder, and the "**saf_mkl_custom.lib**" for you to use locally, enter the following commands:</li>
</ol>
<div class="fragment"><div class="line">cd /Program Files (x86)/IntelSWTools/compilers_and_libraries/windows/mkl/tools/builder</div>
<div class="line">nmake intel64 interface=lp64 threading=sequential name=saf_mkl_custom export=saf_mkl_list</div>
<div class="line"> </div>
<div class="line">xcopy saf_mkl_custom.dll C:\Windows\System32 /R</div>
<div class="line">xcopy saf_mkl_custom.lib C:\Users\[YOUR WORKING DIRECTORY]\Spatial_Audio_Framework\dependencies\Win64\lib /R</div>
</div><!-- fragment --><ol type="1">
<li>OR (The red pill): you may instead build a threaded version of the library (which involves some additional steps):</li>
</ol>
<div class="fragment"><div class="line">cd /Program Files (x86)/IntelSWTools/compilers_and_libraries/windows/mkl/tools/builder</div>
<div class="line">nmake intel64 interface=lp64 threading=parallel name=saf_mkl_custom export=saf_mkl_list</div>
<div class="line"> </div>
<div class="line">xcopy saf_mkl_custom.dll C:\Windows\System32 /R</div>
<div class="line">xcopy saf_mkl_custom.lib C:\Users\[YOUR WORKING DIRECTORY]\Spatial_Audio_Framework\dependencies\Win64\lib /R</div>
<div class="line"> </div>
<div class="line">cd C:/Program Files (x86)/IntelSWTools/compilers_and_libraries/windows/compiler/lib/intel64/ </div>
<div class="line">xcopy libiomp5md.lib C:\Users\[YOUR WORKING DIRECTORY]\Spatial_Audio_Framework\dependencies\Win64\lib /R</div>
<div class="line"> </div>
<div class="line">cd C:/Program Files (x86)/IntelSWTools/compilers_and_libraries/windows/redist/intel64/compiler</div>
<div class="line">xcopy libiomp5md.dll C:\Windows\System32 /R</div>
</div><!-- fragment --><ol type="1">
<li>Add the following header search path to your project:</li>
</ol>
<div class="fragment"><div class="line">C:/Program Files (x86)/IntelSWTools/compilers_and_libraries/windows/mkl/include</div>
</div><!-- fragment --><ol type="1">
<li>Add the following library search path to your project:</li>
</ol>
<div class="fragment"><div class="line">C:/Users/[YOUR WORKING DIRECTORY]/SDKs/Spatial_Audio_Framework/dependencies/Win64/lib</div>
</div><!-- fragment --><ol type="1">
<li>link your project against the following libraries (note that the second library is only needed if you built the threaded version): <div class="fragment"><div class="line">saf_mkl_custom.lib</div>
<div class="line">libiomp5md.lib</div>
</div><!-- fragment --></li>
<li>Add "SAF_USE_INTEL_MKL" to your pre-processor definitions.</li>
</ol>
<p>Note: If you built the threaded version of the library, then there are some more pre-processors defintions you can use. See below.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
MacOSX users</h1>
<p>By default, the framework will use Apple's Accelerate library for the BLAS/LAPACK routines and FFT, so you may ignore all of these steps if you wish. However, Mac users may still elect to use Intel MKL, as is it often faster than Accelerate.</p>
<ol type="1">
<li>Install <a href="https://software.intel.com/en-us/articles/free-ipsxe-tools-and-libraries">Intel MKL</a>. Optionally, you may want to add the MKL global environment variables using this command:</li>
</ol>
<div class="fragment"><div class="line">source /opt/intel/compilers_and_libraries/mac/mkl/bin/mklvars.sh intel64</div>
</div><!-- fragment --><ol type="1">
<li>The required custom library may be obtained by first copying the included "**dependencies/saf_mkl_list**" file into the MKL "builder" folder:</li>
</ol>
<div class="fragment"><div class="line">sudo cp saf_mkl_list /opt/intel/compilers_and_libraries/mac/mkl/tools/builder</div>
</div><!-- fragment --><ol type="1">
<li>EITHER (The blue pill): to generate and copy the "**saf_mkl_custom.dylib**" library to a system path folder, ready for you to use, enter the following commands:</li>
</ol>
<div class="fragment"><div class="line">cd /opt/intel/compilers_and_libraries/mac/mkl/tools/builder</div>
<div class="line">sudo make intel64 interface=lp64 threading=sequential name=libsaf_mkl_custom export=saf_mkl_list</div>
<div class="line">sudo cp saf_mkl_custom.dylib /usr/local/lib</div>
</div><!-- fragment --><ol type="1">
<li>OR (The red pill): you may instead build a threaded version of the library (which involves some additional steps):</li>
</ol>
<div class="fragment"><div class="line">cd /opt/intel/compilers_and_libraries/mac/mkl/tools/builder</div>
<div class="line">sudo make intel64 interface=lp64 threading=parallel name=libsaf_mkl_custom export=saf_mkl_list</div>
<div class="line"> </div>
<div class="line">sudo cp saf_mkl_custom.dylib /usr/local/lib</div>
<div class="line">sudo cp /opt/intel/compilers_and_libraries/mac/compiler/lib/libiomp5.dylib /usr/local/lib</div>
</div><!-- fragment --><ol type="1">
<li>Add the following header search path to your project:</li>
</ol>
<div class="fragment"><div class="line">/opt/intel/compilers_and_libraries/mac/mkl/include</div>
</div><!-- fragment --><ol type="1">
<li>Then add the following linker flags to your project (note that the second library is only needed if you built the threaded version):</li>
</ol>
<div class="fragment"><div class="line">-L/usr/local/lib -lsaf_mkl_custom</div>
<div class="line">-L/usr/local/lib -liomp5    </div>
</div><!-- fragment --><ol type="1">
<li>Finally, add "SAF_USE_INTEL_MKL" to your project's pre-processor definitions.</li>
</ol>
<p>Note: If you built the threaded version of the library, then there are some more pre-processors defintions you can use. See below.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Linux (amd64) users</h1>
<p>0. Add the following directories to the header search paths:</p>
<div class="fragment"><div class="line">Spatial_Audio_Framework/framework/include</div>
<div class="line">Spatial_Audio_Framework/dependencies/Linux/include</div>
</div><!-- fragment --><ol type="1">
<li>Add the following directory to the library search paths:</li>
</ol>
<div class="fragment"><div class="line">Spatial_Audio_Framework/dependencies/Linux/lib</div>
</div><!-- fragment --><ol type="1">
<li>Install <a href="https://software.intel.com/en-us/articles/free-ipsxe-tools-and-libraries">Intel MKL</a>.</li>
<li>The required "**saf_mkl_custom.so**" file may be generated using Intel's custom dll builder.</li>
<li>First copy the included "dependencies/saf_mkl_list" file to this folder:</li>
</ol>
<div class="fragment"><div class="line">/opt/intel/compilers_and_libraries/linux/mkl/tools/builder</div>
</div><!-- fragment --><ol type="1">
<li>To generate and copy this library to a system path folder, use the following commands (root permissions required):</li>
</ol>
<div class="fragment"><div class="line">cd /opt/intel/compilers_and_libraries/linux/mkl/tools/builder</div>
<div class="line">sudo make intel64 interface=lp64 threading=sequential name=libsaf_mkl_custom export=saf_mkl_list</div>
<div class="line">sudo cp saf_mkl_custom.so /usr/lib</div>
</div><!-- fragment --><ol type="1">
<li>Then add the following linker flag to your project:</li>
</ol>
<div class="fragment"><div class="line">-L/usr/lib -lsaf_mkl_custom</div>
</div><!-- fragment --><ol type="1">
<li>Add "SAF_USE_INTEL_MKL" to your pre-processor definitions.</li>
</ol>
<h1><a class="anchor" id="autotoc_md4"></a>
Intel MKL threading options (Optional)</h1>
<p>If you built a threaded version of the custom library, then there are some additional options you may specify. More information can be found <a href="https://software.intel.com/en-us/articles/recommended-settings-for-calling-intel-mkl-routines-from-multi-threaded-applications">here</a>.</p>
<p>Note by default: MKL_NUM_THREADS = [number of CPU cores], MKL_DYNAMIC = 1.</p>
<p>You may also change these at run time using the following functions:</p>
<div class="fragment"><div class="line">/* for example: */</div>
<div class="line">MKL_Set_Num_Threads(2);</div>
<div class="line">MKL_Set_Dynamic(1);</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Mar 4 2020 13:32:58 for Spatial_Audio_Framework by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>

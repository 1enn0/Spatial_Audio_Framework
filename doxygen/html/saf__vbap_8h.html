<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Spatial_Audio_Framework: /Users/mccorml1/Documents/SourceTree/SPARTA_VSTs_public/SDKs/Spatial_Audio_Framework/framework/modules/saf_vbap/saf_vbap.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Spatial_Audio_Framework
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('saf__vbap_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">saf_vbap.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Public part of the "saf_vbap" module.  
<a href="#details">More...</a></p>

<p><a href="saf__vbap_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa5b0e087cd867a66cf6781570af37403"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="saf__vbap_8h.html#aa5b0e087cd867a66cf6781570af37403">generateVBAPgainTable3D_srcs</a> (float *src_dirs_deg, int S, float *ls_dirs_deg, int L, int omitLargeTriangles, int enableDummies, float spread, float **gtable, int *N_gtable, int *nTriangles)</td></tr>
<tr class="memdesc:aa5b0e087cd867a66cf6781570af37403"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates a 3-D VBAP [1] gain table based on specified source and loudspeaker directions, with optional spreading [2].  <a href="saf__vbap_8h.html#aa5b0e087cd867a66cf6781570af37403">More...</a><br /></td></tr>
<tr class="separator:aa5b0e087cd867a66cf6781570af37403"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa24e445a98791a5bbd9f4ecd3c949249"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="saf__vbap_8h.html#aa24e445a98791a5bbd9f4ecd3c949249">generateVBAPgainTable3D</a> (float *ls_dirs_deg, int L, int az_res_deg, int el_res_deg, int omitLargeTriangles, int enableDummies, float spread, float **gtable, int *N_gtable, int *nTriangles)</td></tr>
<tr class="memdesc:aa24e445a98791a5bbd9f4ecd3c949249"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates a 3-D VBAP gain table based on specified loudspeaker directions, with optional spreading [2].  <a href="saf__vbap_8h.html#aa24e445a98791a5bbd9f4ecd3c949249">More...</a><br /></td></tr>
<tr class="separator:aa24e445a98791a5bbd9f4ecd3c949249"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae06c7d731756572e43b85f249ffb81d5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="saf__vbap_8h.html#ae06c7d731756572e43b85f249ffb81d5">compressVBAPgainTable3D</a> (float *vbap_gtable, int nTable, int nDirs, float *vbap_gtableComp, int *vbap_gtableIdx)</td></tr>
<tr class="memdesc:ae06c7d731756572e43b85f249ffb81d5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compresses a VBAP gain table to use less memory and CPU (by removing the elements that are zero).  <a href="saf__vbap_8h.html#ae06c7d731756572e43b85f249ffb81d5">More...</a><br /></td></tr>
<tr class="separator:ae06c7d731756572e43b85f249ffb81d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa637de69b5718effebcdb18bef1c3016"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="saf__vbap_8h.html#aa637de69b5718effebcdb18bef1c3016">VBAPgainTable2InterpTable</a> (float *vbap_gtable, int nTable, int nDirs)</td></tr>
<tr class="memdesc:aa637de69b5718effebcdb18bef1c3016"><td class="mdescLeft">&#160;</td><td class="mdescRight">Renormalises a vbap gain table in-place, so it may be utilised for interpolation of data (for example, powermaps or HRTFs).  <a href="saf__vbap_8h.html#aa637de69b5718effebcdb18bef1c3016">More...</a><br /></td></tr>
<tr class="separator:aa637de69b5718effebcdb18bef1c3016"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa67a9d1c155cf65880cbb4529482321"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="saf__vbap_8h.html#aaa67a9d1c155cf65880cbb4529482321">generateVBAPgainTable2D_srcs</a> (float *src_dirs_deg, int S, float *ls_dirs_deg, int L, float **gtable, int *N_gtable, int *nPairs)</td></tr>
<tr class="memdesc:aaa67a9d1c155cf65880cbb4529482321"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates a 2-D VBAP gain table based on specified source and loudspeaker directions.  <a href="saf__vbap_8h.html#aaa67a9d1c155cf65880cbb4529482321">More...</a><br /></td></tr>
<tr class="separator:aaa67a9d1c155cf65880cbb4529482321"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaee4a2148d03e19ed807a43d147384f3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="saf__vbap_8h.html#aaee4a2148d03e19ed807a43d147384f3">generateVBAPgainTable2D</a> (float *ls_dirs_deg, int L, int az_res_deg, float **gtable, int *N_gtable, int *nPairs)</td></tr>
<tr class="memdesc:aaee4a2148d03e19ed807a43d147384f3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates a 2-D VBAP gain table based on specified loudspeaker directions.  <a href="saf__vbap_8h.html#aaee4a2148d03e19ed807a43d147384f3">More...</a><br /></td></tr>
<tr class="separator:aaee4a2148d03e19ed807a43d147384f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1c8fd2b18c5ca774c606a5b1ebc7928"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="saf__vbap_8h.html#af1c8fd2b18c5ca774c606a5b1ebc7928">getPvalues</a> (float DTT, float *freq, int nFreq, float *pValues)</td></tr>
<tr class="memdesc:af1c8fd2b18c5ca774c606a5b1ebc7928"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the frequency dependent pValues, which can be applied to ENERGY normalised VBAP gains, to compensate for the room effect on the perceived loudness fluctuations of sources when panning between loudspeakers.  <a href="saf__vbap_8h.html#af1c8fd2b18c5ca774c606a5b1ebc7928">More...</a><br /></td></tr>
<tr class="separator:af1c8fd2b18c5ca774c606a5b1ebc7928"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Public part of the "saf_vbap" module. </p>
<p>VBAP functions largely derived from the MATLAB library by Archontis Politis, found in [1].</p>
<dl class="section see"><dt>See also</dt><dd>[1] <a href="https://github.com/polarch/Vector-Base-Amplitude-Panning">https://github.com/polarch/Vector-Base-Amplitude-Panning</a></dd></dl>
<dl class="section author"><dt>Author</dt><dd>Leo McCormack </dd></dl>
<dl class="section date"><dt>Date</dt><dd>02.10.2017 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ae06c7d731756572e43b85f249ffb81d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae06c7d731756572e43b85f249ffb81d5">&#9670;&nbsp;</a></span>compressVBAPgainTable3D()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void compressVBAPgainTable3D </td>
          <td>(</td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>vbap_gtable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nTable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nDirs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>vbap_gtableComp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>vbap_gtableIdx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Compresses a VBAP gain table to use less memory and CPU (by removing the elements that are zero). </p>
<p>Handy for large grid sizes for interpolation purposes. Therefore, the gains are also re-normalised to have the AMPLITUDE-preserving property. If 'vbap_gtable' is generated by generateVBAPgainTable3D, then the compressed tables should be accessed as: </p><div class="fragment"><div class="line">N_azi = (int)(360.0f / aziRes + 0.5f) + 1;</div>
<div class="line">aziIndex = (int)(<a class="code" href="saf__misc_8h.html#a3b9806b290b960cd718bac53080235ae">matlab_fmodf</a>(AZI + 180.0f, 360.0f)/az_res_deg + 0.5f);</div>
<div class="line">elevIndex = (int)((ELEVATION + 90.0f) / el_res_deg + 0.5f);</div>
<div class="line">idx3d = elevIndex * N_azi + aziIndex;</div>
<div class="line"><span class="keywordflow">for</span> (i = 0; i &lt; 3; i++){</div>
<div class="line">    gains[i] =  vbap_gtableComp[idx3d*3+i];</div>
<div class="line">    idx[i]   =  vbap_gtableIdx[idx3d*3+i];</div>
<div class="line">}</div>
</div><!-- fragment --><p> where 'gains' are then the gains for loudspeakers('idx') to pan the source to [AZI ELEV], using the nearest grid point</p>
<dl class="section note"><dt>Note</dt><dd>The VBAP gains are AMPLITUDE normalised; i.e. sum(gains) = 1</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">vbap_gtable</td><td>The 3D VBAP gain table; FLAT: nTable x nDirs </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nTable</td><td>number of points in the gain table </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nDirs</td><td>number of loudspeakers </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">vbap_gtableComp</td><td>The compressed 3D VBAP gain table AMPLITUDE- NORMALISED; FLAT: nTable x 3 </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">vbap_gtableIdx</td><td>The indices for the compressed 3D VBAP gain table; FLAT: nTable x 3 </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aaee4a2148d03e19ed807a43d147384f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaee4a2148d03e19ed807a43d147384f3">&#9670;&nbsp;</a></span>generateVBAPgainTable2D()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void generateVBAPgainTable2D </td>
          <td>(</td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>ls_dirs_deg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>L</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>az_res_deg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>gtable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>N_gtable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>nPairs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Generates a 2-D VBAP gain table based on specified loudspeaker directions. </p>
<p>This function generates the VBAP gains for a grid: -180:az_res_deg:180 azimuths, which should be accessed as: </p><div class="fragment"><div class="line">aziIndex = (int)(<a class="code" href="saf__misc_8h.html#a3b9806b290b960cd718bac53080235ae">matlab_fmodf</a>(AZI + 180.0f, 360.0f)/az_res_deg + 0.5f);</div>
<div class="line">idx2d = aziIndex;</div>
<div class="line"><span class="keywordflow">for</span> (ls = 0; ls &lt; L; ls++){</div>
<div class="line">    gains2D[ls] =  gtable[idx2d*L+ls];}</div>
</div><!-- fragment --><p> 'gains2D' are then the loudspeaker gains to pan the source to [AZI 0], using the nearest grid point.</p>
<dl class="section note"><dt>Note</dt><dd>The VBAP gains are ENERGY normalised; i.e. sum(gains^2) = 1</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ls_dirs_deg</td><td>Loudspeaker directions in DEGREES (elev assumed to be 0 for all); FLAT: L x 2 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">L</td><td>Number of loudspeakers </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">az_res_deg</td><td>Azimuthal resolution in DEGREES </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">gtable</td><td>(&amp;) The 2D VBAP gain table ENERGY NORMALISED; FLAT: S x L </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">N_gtable</td><td>(&amp;) number of points in the gain table, N_gtable=S </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">nPairs</td><td>(&amp;) number of loudspeaker pairs </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aaa67a9d1c155cf65880cbb4529482321"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaa67a9d1c155cf65880cbb4529482321">&#9670;&nbsp;</a></span>generateVBAPgainTable2D_srcs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void generateVBAPgainTable2D_srcs </td>
          <td>(</td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>src_dirs_deg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>S</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>ls_dirs_deg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>L</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>gtable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>N_gtable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>nPairs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Generates a 2-D VBAP gain table based on specified source and loudspeaker directions. </p>
<dl class="section note"><dt>Note</dt><dd>source and loudspeaker directions are required to be inter-leaved with zeros, i.e. [src_az1, 0; src_az2, 0; src_az3, 0;]. The VBAP gains are also ENERGY normalised; i.e. sum(gains^2) = 1</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">src_dirs_deg</td><td>Source directions in DEGREES (elev assumed to be 0 for all); FLAT: S x 2 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">S</td><td>Number of Sources </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ls_dirs_deg</td><td>Loudspeaker directions in DEGREES (elev assumed to be 0 for all); FLAT: L x 2 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">L</td><td>Number of loudspeakers </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">gtable</td><td>(&amp;) The 2D VBAP gain table ENERGY NORMALISED; FLAT: S x L </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">N_gtable</td><td>(&amp;) number of points in the gain table, N_gtable=S </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">nPairs</td><td>(&amp;) number of loudspeaker pairs </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aa24e445a98791a5bbd9f4ecd3c949249"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa24e445a98791a5bbd9f4ecd3c949249">&#9670;&nbsp;</a></span>generateVBAPgainTable3D()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void generateVBAPgainTable3D </td>
          <td>(</td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>ls_dirs_deg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>L</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>az_res_deg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>el_res_deg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>omitLargeTriangles</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>enableDummies</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>spread</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>gtable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>N_gtable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>nTriangles</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Generates a 3-D VBAP gain table based on specified loudspeaker directions, with optional spreading [2]. </p>
<p>This function generates the VBAP gains for a grid: -180:az_res_deg:180 azimuths and -90:el_res_deg:90 elevations, which should be accessed as: </p><div class="fragment"><div class="line">N_azi = (int)(360.0f / aziRes + 0.5f) + 1;</div>
<div class="line">aziIndex = (int)(<a class="code" href="saf__misc_8h.html#a3b9806b290b960cd718bac53080235ae">matlab_fmodf</a>(AZI + 180.0f, 360.0f)/az_res_deg + 0.5f);</div>
<div class="line">elevIndex = (int)((ELEV + 90.0f) / el_res_deg + 0.5f);</div>
<div class="line">idx3d = elevIndex * N_azi + aziIndex;</div>
<div class="line"><span class="keywordflow">for</span> (ls = 0; ls &lt; L; ls++)</div>
<div class="line">    gains3D[ls] =  gtable[idx3d*L+ls];}</div>
</div><!-- fragment --><p> where 'gains3D' are the loudspeaker gains to pan the source to [AZI ELEV], using the nearest grid point</p>
<dl class="section note"><dt>Note</dt><dd>'gtable' is returned as NULL if the triangulation failed. The VBAP gains are also ENERGY normalised; i.e. sum(gains^2) = 1</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ls_dirs_deg</td><td>Loudspeaker directions in DEGREES; FLAT: L x 2 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">L</td><td>Number of loudspeakers </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">az_res_deg</td><td>Azimuthal resolution in DEGREES </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">el_res_deg</td><td>Elevation resolution in DEGREES </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">omitLargeTriangles</td><td>'0' normal triangulation, '1' remove large triangles </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">enableDummies</td><td>'0' disabled, '1' enabled. Dummies are placed at +/-90 elevation if required </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">spread</td><td>Spreading factor in DEGREES, 0: VBAP, &gt;0: MDAP </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">gtable</td><td>(&amp;) The 3D VBAP gain table ENERGY NORMALISED; FLAT: N_gtable x L </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">N_gtable</td><td>(&amp;) number of points in the gain table </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">nTriangles</td><td>(&amp;) number of loudspeaker triangles</td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd>[1] Pulkki, V. (1997). Virtual sound source positioning using vector base amplitude panning. Journal of the audio engineering society, 45(6), 456-466. </dd>
<dd>
[2] Pulkki, V. (1999). Uniform spreading of amplitude panned virtual sources. In Proceedings of the 1999 IEEE Workshop on Applications of Signal Processing to Audio and Acoustics. WASPAA'99 (Cat. No. 99TH8452) (pp. 187-190). IEEE. </dd></dl>

</div>
</div>
<a id="aa5b0e087cd867a66cf6781570af37403"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa5b0e087cd867a66cf6781570af37403">&#9670;&nbsp;</a></span>generateVBAPgainTable3D_srcs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void generateVBAPgainTable3D_srcs </td>
          <td>(</td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>src_dirs_deg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>S</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>ls_dirs_deg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>L</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>omitLargeTriangles</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>enableDummies</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>spread</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>gtable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>N_gtable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>nTriangles</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Generates a 3-D VBAP [1] gain table based on specified source and loudspeaker directions, with optional spreading [2]. </p>
<dl class="section note"><dt>Note</dt><dd>gtable is returned as NULL if the triangulation failed. The VBAP gains are also ENERGY normalised; i.e. sum(gains^2) = 1</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">src_dirs_deg</td><td>Source directions in DEGREES; FLAT: S x 2 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">S</td><td>Number of Sources </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ls_dirs_deg</td><td>Loudspeaker directions in DEGREES; FLAT: L x 2 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">L</td><td>Number of loudspeakers </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">omitLargeTriangles</td><td>'0' normal triangulation, '1' remove large triangles </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">enableDummies</td><td>'0' disabled, '1' enabled, and dummies are placed at +/-90 elevation if required </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">spread</td><td>Spreading factor in DEGREES, 0: VBAP, &gt;0: MDAP </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">gtable</td><td>(&amp;) The 3D VBAP gain table ENERGY NORMALISED; FLAT: N_gtable x L </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">N_gtable</td><td>(&amp;) number of points in the gain table </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">nTriangles</td><td>(&amp;) number of loudspeaker triangles</td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd>[1] Pulkki, V. (1997). Virtual sound source positioning using vector base amplitude panning. Journal of the audio engineering society, 45(6), 456-466. </dd>
<dd>
[2] Pulkki, V. (1999). Uniform spreading of amplitude panned virtual sources. In Proceedings of the 1999 IEEE Workshop on Applications of Signal Processing to Audio and Acoustics. WASPAA'99 (Cat. No. 99TH8452) (pp. 187-190). IEEE. </dd></dl>

</div>
</div>
<a id="af1c8fd2b18c5ca774c606a5b1ebc7928"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1c8fd2b18c5ca774c606a5b1ebc7928">&#9670;&nbsp;</a></span>getPvalues()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void getPvalues </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>DTT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>freq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nFreq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>pValues</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the frequency dependent pValues, which can be applied to ENERGY normalised VBAP gains, to compensate for the room effect on the perceived loudness fluctuations of sources when panning between loudspeakers. </p>
<p>This should be applied as: </p><div class="fragment"><div class="line"><span class="keywordflow">if</span>(pValues[band] != 2.0f){</div>
<div class="line">    gains3D_sum_pvf = 0.0f;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; nLoudspeakers; i++){</div>
<div class="line">        gains3D_sum_pvf += powf(MAX(gains[i], 0.0f), pValues[band]);}</div>
<div class="line">    gains3D_sum_pvf = powf(gains3D_sum_pvf, 1.0f/(pValues[band]+2.23e-13f));</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; nLoudspeakers; i++){</div>
<div class="line">        gains_p[i] = gains[i] / (gains3D_sum_pvf+2.23e-13f);}</div>
<div class="line">}</div>
</div><!-- fragment --><p>Where "gains" are the original energy normalised VBAP gains and "gains_p" have amplitude normalisation for the low frequencies, and energy normalisation at the high frequencies [1].</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">DTT</td><td>0..1 '0': for normal room, '1' for anechoic room, '0.5' for listening room </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">freq</td><td>Frequency vector in Hz; nFreq x 1 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nFreq</td><td>Number of frequencies in the frequency vector </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">pValues</td><td>pValues for each frequency; nFreq x 1</td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd>[1] Laitinen, M., Vilkamo, J., Jussila, K., Politis, A., Pulkki, V. (2014). Gain normalisation in amplitude panning as a function of frequency and room reverberance. 55th International Conference of the AES. Helsinki, Finland. </dd></dl>

</div>
</div>
<a id="aa637de69b5718effebcdb18bef1c3016"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa637de69b5718effebcdb18bef1c3016">&#9670;&nbsp;</a></span>VBAPgainTable2InterpTable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void VBAPgainTable2InterpTable </td>
          <td>(</td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>vbap_gtable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nTable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nDirs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Renormalises a vbap gain table in-place, so it may be utilised for interpolation of data (for example, powermaps or HRTFs). </p>
<dl class="section note"><dt>Note</dt><dd>The VBAP gains are AMPLITUDE normalised; i.e. sum(gains) = 1.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">vbap_gtable</td><td>The 3D VBAP gain table; FLAT: nTable x nDirs </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nTable</td><td>Number of points in the gain table </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nDirs</td><td>Number of loudspeakers </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="asaf__misc_8h_html_a3b9806b290b960cd718bac53080235ae"><div class="ttname"><a href="saf__misc_8h.html#a3b9806b290b960cd718bac53080235ae">matlab_fmodf</a></div><div class="ttdeci">float matlab_fmodf(float x, float y)</div><div class="ttdoc">C fmodf function, which behaves like 'mod' in Matlab (with the wrap around)</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_644e041c3a6521da7b27eba0e4eb2b95.html">framework</a></li><li class="navelem"><a class="el" href="dir_56553b6b74e7f4a7717200a52c59b140.html">modules</a></li><li class="navelem"><a class="el" href="dir_97f95191d2c7b5fb3b10cd798a66ec79.html">saf_vbap</a></li><li class="navelem"><a class="el" href="saf__vbap_8h.html">saf_vbap.h</a></li>
    <li class="footer">Generated on Wed Mar 4 2020 13:32:58 for Spatial_Audio_Framework by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
